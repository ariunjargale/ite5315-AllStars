<div class="admin-page">
    <h1 class="admin-title">USER MANAGEMENT</h1>
    <p class="admin-subtitle">Manage all registered users</p>

    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{#each users}}
                <tr class="{{#if this.isBlocked}}blocked-row{{/if}}">
                    <td>{{this.username}}</td>
                    <td>{{this.email}}</td>
                    <td>
                        <span class="role-badge {{#if (eq this.role 'admin')}}role-admin{{else}}role-user{{/if}}">
                            {{this.role}}
                        </span>
                    </td>
                    <td>
                        {{#if this.isBlocked}}
                        <span class="status-badge status-blocked">Blocked</span>
                        {{else if this.requirePasswordReset}}
                        <span class="status-badge status-reset">Reset Required</span>
                        {{else}}
                        <span class="status-badge status-active">Active</span>
                        {{/if}}
                    </td>
                    <td>{{this.created}}</td>
                    <td class="action-buttons">
                        {{#unless (eq this._id ../session.userId)}}
                        <form action="/admin/block/{{this._id}}" method="POST" style="display:inline;">
                            <button type="submit"
                                class="btn-admin {{#if this.isBlocked}}btn-unblock{{else}}btn-block{{/if}}">
                                {{#if this.isBlocked}}Unblock{{else}}Block{{/if}}
                            </button>
                        </form>
                        <form action="/admin/reset-password/{{this._id}}" method="POST" style="display:inline;">
                            <button type="submit" class="btn-admin btn-reset">Force Reset</button>
                        </form>
                        <form action="/admin/delete/{{this._id}}" method="POST" style="display:inline;"
                            onsubmit="return confirm('Are you sure you want to delete this user? This cannot be undone.');">
                            <button type="submit" class="btn-admin btn-delete">Delete</button>
                        </form>
                        {{else}}
                        <span class="current-user-label">(You)</span>
                        {{/unless}}
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>